## 接口原则

- 接口返回数据即显示：前端仅做渲染逻辑处理
- 渲染逻辑禁止跨多个接口调用
- 前端关注交互、渲染逻辑，尽量避免业务逻辑处理的出现
- 请求响应传输数据格式：JSON，JSON数据尽量简单轻量，避免多级JSON的出现
- 接口定义好之后，前后端开发人员都应严格遵守，如遇需修改接口定义的应协商修改，保证信息同步，避免修改接口导致的边界问题


## 接口定义

接口定义规范参见 [RESTful 设计指南](/frontend_backend_separation/RESTful%20设计指南.md)


## 接口数据格式规范

### 使用 JSON

使用JSON格式传输数据，JSON 是一种可以跨平台高扩展的轻量级的数据交换格式。易于人阅读和编写，同时也易于机器解析和生成。在 http 请求头和响应头申明 Content-Type。返回的数据结构应该做到尽可能简单，不要过于包装。响应状态应该包含在响应头中！

**Request**

```
Accept: application/json
Content-Type: application/json;charset=UTF-8
```

**Response**

```
Content-Type: application/json;charset=UTF-8
```


#### JSON 属性定义建议

1. 属性名应该是具有定义语义的有意义的名称；

2. 首字母不能使用大写(大小写友好)；

3. 使用小驼峰命名，这条由组内开发成员根据开发习惯而定，也可使用下划线方式命名；

4. 属性和字符串值必须使用双引号`""`；

5. 数组类型应该是复数属性名。其它属性名都应该是单数。

6. 当JSON对象作为Map(映射)使用时，属性的名称命名规则并不适用，如：

```
{
    "id":"123",
    "status": {
        "组长":1,
        "主任":2,
        "校长":3
    }
}
```

#### JSON 属性值准则

- 属性值必须是Unicode 的 booleans（布尔）, 数字(numbers), 字符串(strings), 对象(objects), 数组(arrays), 或 null；
- 接口遵循“输入宽容，输出严格”原则，输出的数据结构中空字段的值一律为 `null`, 是 `null` 不是字符串 `"null"`；
- 如果一个属性是可选的或者包含空值或null值，考虑从JSON中去掉该属性，除非它的存在有很强的语义原因；


### response 数据格式建议

#### 响应基本数据格式

```
{
    "code": 200,
    "message": "success"
}
```

#### 响应实体格式

```
{
    "code": 200,
    "message": "success",
    "data": {
        "entity": {
            "id": 1,
            "name": "XXX",
            "phone": "XXX"
        }
    }
}
```
*entity: 响应返回的实体数据*

#### 响应列表格式
```
{
    "code": 200,
    "message": "success",
    "data": {
        "list":[
            {
                "id": 1,
                "name": "XXX",
                "code": "XXX"
            },
            {
                "id": 2,
                "name": "XXX",
                "code": "XXX"
            },
            {
                "id": 3,
                "name": "XXX",
                "code": "XXX"
            }
        ]
    }
}
```
*list: 响应返回的列表数据*

#### 响应分页格式

```
{
    "code": 200,
    "message":"success",
    "data": {
        "totalCount": 2, // 总记录数
        "totalPage": 1  // 总页数
        "pageNo": 1, // 当前页码
        "pageSize": 10, // 每页大小
        "list":[
            {
                "id": 1,
                "name": "XXX",
                "code": "XXX"
            },
            {
                "id": 2,
                "name": "XXX",
                "code": "XXX"
            },
            {
                "id": 3,
                "name": "XXX",
                "code": "XXX"
            }
        ],
    }
}
```

#### 响应特殊数据格式

对于特定组件数据格式由后端统一处理后返回前端，如（echart、ztree等组件）

#### 特殊内容规范

##### 布尔类型

关于布尔类型，一律返回`BOOLEN`类型值

##### 日期格式

关于日期类型，JSON数据传输中一律使用字符串格式时间戳，具体日期格式因业务而定


## 身份验证以及角色分配

所有 API 接口 除了文档等特定的接口外都需要通过身份验证。支持通过登录接口使用账号密码获取，在请求接口时使用`Authorization: Bearer #{token}` 头标或者 `token` 参数的值的方式进行验证。

在前后端分离中，项目前端无法获取用户角色信息，可以根据如下设计获取角色信息以及 token:

1. 浏览器一旦加载完该项目前端页面之后，前端主动发起 `/current_username` 请求，

2. 测试环境，从 `/current_username` 返回默认数据，请求拿到用户角色信息和 token 之后，将 token 信息注入之后的所有 API 请求的 header 头里，通过服务器端身份验证，合法请求到数据。

前后端分离项目中都是通过此种方法获得用户角色信息和类型从而进行权限限制，让不同角色的人看见不同的菜单。


## reference

- https://github.com/paddingme/Frontend-Backend-Separation/blob/master/api.md